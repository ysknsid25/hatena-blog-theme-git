<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
    </head>
    <body>
        <div class="float-btn-group">
            <span class="hb-float-item">
                <a
                    href="https://b.hatena.ne.jp/entry/"
                    class="hb-float-btn"
                    id="hb-float-link"
                    target="_blank"
                    rel="noopener noreferrer"
                    title="ã“ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ "
                >
                    B!
                    <span class="hb-chip" id="hb-count"></span>
                </a>
            </span>
            <a
                href="https://blog.hatena.ne.jp/ysknsid25/karanohako.hatenablog.jp/subscribe?utm_source=blogs_entry_footer&utm_campaign=subscribe_blog&utm_medium=button&utm_content=float"
                class="reader-float-btn"
            >
                èª­è€…ã«ãªã‚Šã¾ã›ã‚“ã‹ï¼ŸğŸ‘€
            </a>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const targets = document.querySelectorAll(
                    '[name="subscribe-original"], .hatena-module-profile, .hatena-module-category, .hatena-module-archive, .hatena-module-links, .hatena-module-recent-entries',
                );
                const group = document.querySelector(".float-btn-group");
                const hbItem = document.querySelector(".hb-float-item");
                const hbLink = document.getElementById("hb-float-link");
                const hbCount = document.getElementById("hb-count");
                const visibleElements = new Set();

                const isEntryPage =
                    document.querySelectorAll(".entry").length === 1;

                if (hbItem && isEntryPage) {
                    hbItem.classList.add("entry-visible");

                    // ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒªãƒ³ã‚¯ã®URLã‚’ç¾åœ¨ãƒšãƒ¼ã‚¸ã«è¨­å®š
                    const pageUrl = window.location.href;
                    if (hbLink) {
                        hbLink.href =
                            "https://b.hatena.ne.jp/entry/s/" +
                            pageUrl.replace(/^https?:\/\//, "");
                    }

                    // JSONP ã§ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ•°ã‚’å–å¾—
                    const cbName = "hbCb_" + Date.now();
                    window[cbName] = function (data) {
                        if (data && data.count > 0 && hbCount) {
                            hbCount.textContent = data.count;
                            hbCount.classList.add("visible");
                        }
                        delete window[cbName];
                        const s = document.getElementById("hb-js");
                        if (s) s.remove();
                    };
                    const script = document.createElement("script");
                    script.id = "hb-js";
                    script.src =
                        "https://b.hatena.ne.jp/entry/jsonlite/?url=" +
                        encodeURIComponent(pageUrl) +
                        "&callback=" +
                        cbName;
                    document.head.appendChild(script);
                }

                const showButtons = () => group?.classList.add("visible");
                const hideButtons = () => group?.classList.remove("visible");

                if (targets.length > 0 && group) {
                    const observer = new IntersectionObserver(
                        (entries) => {
                            entries.forEach((entry) => {
                                if (entry.isIntersecting) {
                                    visibleElements.add(entry.target);
                                } else {
                                    visibleElements.delete(entry.target);
                                }
                            });

                            if (visibleElements.size > 0) {
                                hideButtons();
                            } else {
                                showButtons();
                            }
                        },
                        { threshold: 0 },
                    );

                    targets.forEach((el) => observer.observe(el));
                } else if (group) {
                    showButtons();
                }
            });
        </script>
    </body>
</html>
